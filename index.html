<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Bill Up — Intelligence Prix</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'DM Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#080808;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  ::-webkit-scrollbar{width:0}
  @media(max-width:430px){body{background:#fff;padding:0}}

  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
  @keyframes slideDown{from{opacity:0;transform:translateY(-16px)}to{opacity:1;transform:translateY(0)}}
  @keyframes slideLeft{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
  @keyframes scaleIn{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
  @keyframes expandH{from{max-height:0;opacity:0}to{max-height:600px;opacity:1}}
  @keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
  @keyframes scanMove{0%{top:5%;opacity:0}10%{opacity:1}90%{opacity:1}100%{top:88%;opacity:0}}
  @keyframes dotBounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}
  @keyframes reveal{from{clip-path:inset(0 100% 0 0)}to{clip-path:inset(0 0% 0 0)}}
  @keyframes lineGrow{from{width:0}to{width:40px}}
  @keyframes countUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  @keyframes pulseRing{0%{transform:scale(1);opacity:.6}100%{transform:scale(2.5);opacity:0}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script>
const e=React.createElement,{useState,useEffect,useRef,useCallback}=React;

const INVOICES=[
  {id:1,supplier:"Martin Fournitures",date:"18 Février 2026",items:[{name:"Tube cuivre 22mm (au mètre)",qty:45,unit:"m",price:18.5,category:"Plomberie"},{name:"Raccord laiton T 22mm",qty:12,unit:"pcs",price:8.9,category:"Plomberie"}],total_ht:939.3},
  {id:2,supplier:"Électro-Pro Distribution",date:"15 Février 2026",items:[{name:"Câble R2V 3G2.5 (100m)",qty:2,unit:"bobine",price:189.0,category:"Électricité"},{name:"Disjoncteur 20A Schneider",qty:6,unit:"pcs",price:24.5,category:"Électricité"}],total_ht:525.0},
  {id:3,supplier:"Bois & Matériaux du Sud",date:"12 Février 2026",items:[{name:"Chevron sapin 63×75 (4m)",qty:20,unit:"pcs",price:14.2,category:"Bois"},{name:"Panneau OSB3 18mm 250×125",qty:8,unit:"pcs",price:32.5,category:"Bois"}],total_ht:544.0}
];

const ANALYSIS={
  1:[
    {name:"Tube cuivre 22mm",price:18.5,median:15.04,p10:12.8,p90:17.2,pctAbove:23,severity:"danger",n:847,nSuppliers:34,trend:[13.2,13.5,13.8,14.1,14.6,15.0,14.8,14.5,14.9,15.1,15.0,15.04],alternatives:[{name:"Rexel Île-de-France",price:14.2},{name:"Brossette Paris Sud",price:15.1},{name:"Cedeo Créteil",price:15.8}],seasonMsg:null,inseeRef:"BT40 Électricité-Plomberie · +2.1% / 12 mois"},
    {name:"Raccord laiton T 22mm",price:8.9,median:8.45,p10:7.2,p90:9.8,pctAbove:5,severity:"good",n:612,nSuppliers:28,trend:[8.1,8.2,8.2,8.3,8.3,8.4,8.4,8.3,8.4,8.5,8.4,8.45],alternatives:[],seasonMsg:null,inseeRef:null}
  ],
  2:[
    {name:"Câble R2V 3G2.5",price:189.0,median:162.5,p10:145.0,p90:178.0,pctAbove:16,severity:"warn",n:523,nSuppliers:19,trend:[155,158,160,163,161,159,162,164,163,161,162,162.5],alternatives:[{name:"Rexel Lyon",price:158.0},{name:"Sonepar Rhône",price:164.5}],seasonMsg:"Prix stable — aucun effet saisonnier détecté",inseeRef:"IPP Câbles électriques · +3.8% / 12 mois"},
    {name:"Disjoncteur 20A Schneider",price:24.5,median:22.8,p10:19.5,p90:25.2,pctAbove:7,severity:"caution",n:1203,nSuppliers:42,trend:[21.5,21.8,22.0,22.2,22.5,22.6,22.4,22.7,22.8,22.9,22.8,22.8],alternatives:[],seasonMsg:null,inseeRef:null}
  ],
  3:[
    {name:"Chevron sapin 63×75",price:14.2,median:13.8,p10:11.5,p90:15.5,pctAbove:3,severity:"good",n:389,nSuppliers:22,trend:[12.5,12.8,13.0,13.2,13.5,13.8,14.0,13.9,13.7,13.8,13.9,13.8],alternatives:[],seasonMsg:"Hausse saisonnière habituelle en hiver (+4%)",inseeRef:"BT01 Index BTP · +1.8% / 12 mois"},
    {name:"Panneau OSB3 18mm",price:32.5,median:26.8,p10:23.5,p90:30.2,pctAbove:21,severity:"danger",n:456,nSuppliers:18,trend:[24.5,25.0,25.5,26.0,26.2,26.5,26.8,26.5,26.3,26.7,26.9,26.8],alternatives:[{name:"Point P Marseille",price:24.9},{name:"Dispano Aix",price:26.2},{name:"BigMat Toulon",price:27.5}],seasonMsg:null,inseeRef:"IPP Panneaux bois · −1.2% / 12 mois"}
  ]
};

const SEV={danger:{color:"#1a1a1a",label:"SURFACTURÉ"},warn:{color:"#444",label:"ÉLEVÉ"},caution:{color:"#777",label:"À SURVEILLER"},good:{color:"#1b6b42",label:"PRIX JUSTE"}};
const F="'DM Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif";
const isD=window.innerWidth>430;

function Sparkline({data,currentPrice,median,p10,p90,width=300,height=72}){
  const[drawn,setDrawn]=useState(false);
  useEffect(()=>{const t=setTimeout(()=>setDrawn(true),100);return()=>clearTimeout(t)},[]);
  const all=[...data,currentPrice],mn=Math.min(...all,p10)*.96,mx=Math.max(...all,currentPrice)*1.04,rng=mx-mn||1;
  const px=16,py=8,w=width-px*2,h=height-py*2;
  const toX=i=>px+(i/(data.length-1))*w,toY=v=>py+h-((v-mn)/rng)*h;
  const medY=toY(median),curX=width-px,curY=toY(currentPrice);
  const line=data.map((v,i)=>`${i===0?"M":"L"}${toX(i).toFixed(1)},${toY(v).toFixed(1)}`).join(" ");
  const area=line+` L${toX(data.length-1).toFixed(1)},${py+h} L${px},${py+h} Z`;
  const pLen=data.length*30;
  return e("svg",{width,height,style:{display:"block"}},
    e("defs",null,e("linearGradient",{id:"sA",x1:"0",y1:"0",x2:"0",y2:"1"},e("stop",{offset:"0%",stopColor:"#1b6b42",stopOpacity:"0.1"}),e("stop",{offset:"100%",stopColor:"#1b6b42",stopOpacity:"0.01"}))),
    e("rect",{x:px,y:toY(p90),width:w,height:toY(p10)-toY(p90),fill:"#1b6b42",opacity:"0.04",rx:"1"}),
    e("line",{x1:px,y1:medY,x2:px+w,y2:medY,stroke:"#d0d0d0",strokeWidth:"0.7",strokeDasharray:"4,5"}),
    e("text",{x:px+w+4,y:medY+3,fill:"#888",fontSize:"9",fontFamily:F,fontWeight:"400"},"méd."),
    e("path",{d:area,fill:"url(#sA)",style:{opacity:drawn?1:0,transition:"opacity 1s ease .3s"}}),
    e("path",{d:line,fill:"none",stroke:"#1b6b42",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{strokeDasharray:pLen,strokeDashoffset:drawn?0:pLen,transition:"stroke-dashoffset 1.2s ease"}}),
    ...data.map((v,i)=>e("circle",{key:i,cx:toX(i),cy:toY(v),r:"2.5",fill:"#fff",stroke:"#1b6b42",strokeWidth:"1.2",style:{opacity:drawn?1:0,transition:`opacity .3s ease ${0.1*i}s`}},e("title",null,v.toFixed(2)+"€"))),
    e("line",{x1:curX,y1:curY,x2:curX,y2:medY,stroke:"#1a1a1a",strokeWidth:"1",strokeDasharray:"2,3",style:{opacity:drawn?1:0,transition:"opacity .5s ease 1s"}}),
    e("circle",{cx:curX,cy:curY,r:"5.5",fill:"#1a1a1a",stroke:"#fff",strokeWidth:"2",style:{opacity:drawn?1:0,transition:"opacity .4s ease 1.1s"}},e("animate",{attributeName:"r",values:"5.5;7;5.5",dur:"2s",repeatCount:"indefinite"})),
    e("text",{x:curX-6,y:curY-11,fill:"#1a1a1a",fontSize:"11",fontWeight:"700",textAnchor:"end",fontFamily:F,style:{opacity:drawn?1:0,transition:"opacity .4s ease 1.2s"}},currentPrice.toFixed(1)+"€")
  );
}

function RangeBar({p10,median,p90,current}){
  const[show,setShow]=useState(false);
  useEffect(()=>{const t=setTimeout(()=>setShow(true),150);return()=>clearTimeout(t)},[]);
  const mn=p10*.85,mx=Math.max(p90,current)*1.15,rng=mx-mn||1,toP=v=>((v-mn)/rng)*100;
  return e("div",{style:{position:"relative",height:40,margin:"12px 0 8px"}},
    e("div",{style:{position:"absolute",top:16,left:0,right:0,height:1,background:"#e8e8e8"}}),
    e("div",{style:{position:"absolute",top:11,left:`${toP(p10)}%`,width:show?`${toP(p90)-toP(p10)}%`:"0%",height:10,background:"linear-gradient(90deg,#f5f5f5,#eaeaea,#f5f5f5)",borderRadius:2,transition:"width .8s cubic-bezier(.4,0,.2,1) .2s"}}),
    e("div",{style:{position:"absolute",top:8,left:`${toP(median)}%`,width:2,height:16,background:"#1b6b42",borderRadius:1,opacity:show?1:0,transform:show?"scaleY(1)":"scaleY(0)",transition:"all .5s ease .6s"}}),
    e("div",{style:{position:"absolute",top:8,left:show?`${toP(current)}%`:`${toP(median)}%`,transform:"translateX(-50%)",transition:"left 1s cubic-bezier(.4,0,.2,1) .4s"}},
      e("div",{style:{width:18,height:18,borderRadius:"50%",background:current>p90?"#1a1a1a":current>median*1.05?"#555":"#1b6b42",border:"3px solid #fff",boxShadow:"0 2px 8px rgba(0,0,0,.15),0 0 0 1px rgba(0,0,0,.06)"}})
    ),
    e("div",{style:{position:"absolute",top:30,left:`${toP(p10)}%`,fontFamily:F,fontSize:10,fontWeight:400,color:"#777",opacity:show?1:0,transition:"opacity .5s ease .8s"}},"P10 · "+p10.toFixed(0)+"€"),
    e("div",{style:{position:"absolute",top:30,right:`${100-toP(p90)}%`,fontFamily:F,fontSize:10,fontWeight:400,color:"#777",textAlign:"right",opacity:show?1:0,transition:"opacity .5s ease .8s"}},"P90 · "+p90.toFixed(0)+"€")
  );
}

function Counter({value,suffix="",prefix="",duration=1200}){
  const[display,setDisplay]=useState(0),ref=useRef(null);
  useEffect(()=>{
    const num=parseFloat(String(value).replace(/[^0-9.]/g,""))||0,start=Date.now();
    const tick=()=>{const p=Math.min((Date.now()-start)/duration,1);setDisplay(Math.round(num*(1-Math.pow(1-p,3))));if(p<1)ref.current=requestAnimationFrame(tick)};
    ref.current=requestAnimationFrame(tick);return()=>cancelAnimationFrame(ref.current);
  },[value,duration]);
  return e(React.Fragment,null,prefix,display.toLocaleString("fr-FR"),suffix);
}

function App(){
  const[tab,setTab]=useState("scanner"),[inv,setInv]=useState(null),[phase,setPhase]=useState(null),[prog,setProg]=useState(0),[exp,setExp]=useState(null),[about,setAbout]=useState(false),[hov,setHov]=useState(null);
  const tmr=useRef(null);

  const scan=useCallback(i=>{
    setInv(i);setPhase("scan");setProg(0);setExp(null);
    setTimeout(()=>{setPhase("analyze");let p=0;tmr.current=setInterval(()=>{p+=Math.random()*14+5;if(p>=100){p=100;clearInterval(tmr.current);setTimeout(()=>setPhase("result"),500)}setProg(Math.min(p,100))},200)},1600);
  },[]);
  const reset=useCallback(()=>{clearInterval(tmr.current);setPhase(null);setInv(null);setExp(null)},[]);
  useEffect(()=>()=>clearInterval(tmr.current),[]);

  const items=inv?ANALYSIS[inv.id]:[],worst=items.some(a=>a.severity==="danger")?"danger":items.some(a=>a.severity==="warn")?"warn":items.some(a=>a.severity==="caution")?"caution":"good";
  const overp=items.reduce((s,a)=>s+Math.max(0,a.price-a.median)*(inv?.items.find(i=>i.name.startsWith(a.name.split(" ")[0]))?.qty||1),0);

  const hdr=()=>e("div",{style:{padding:"52px 28px 22px",borderBottom:"1px solid #eee",flexShrink:0,background:"linear-gradient(180deg,#fafafa 0%,#fff 100%)"}},
    e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},
      e("div",{style:{animation:"slideDown .6s ease"}},
        e("div",{style:{fontFamily:F,fontSize:26,fontWeight:600,color:"#0a0a0a",letterSpacing:"0.08em",lineHeight:1}},"BILL ",e("span",{style:{fontWeight:700}},"UP")),
        e("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8}},
          e("div",{style:{width:0,height:1,background:"#1b6b42",animation:"lineGrow .8s ease .3s forwards"}}),
          e("div",{style:{fontFamily:F,fontSize:10,fontWeight:500,color:"#1b6b42",letterSpacing:"0.3em",textTransform:"uppercase",opacity:0,animation:"fadeIn .6s ease .6s forwards"}},"Intelligence Prix")
        )
      ),
      e("button",{onClick:()=>setAbout(!about),style:{fontFamily:F,fontSize:11,fontWeight:400,color:"#666",background:"none",border:"1px solid #ddd",borderRadius:24,padding:"7px 18px",cursor:"pointer",letterSpacing:"0.06em",transition:"all .4s",animation:"fadeIn .8s ease .4s both"},
        onMouseEnter:x=>{x.currentTarget.style.borderColor="#0a0a0a";x.currentTarget.style.color="#0a0a0a";x.currentTarget.style.transform="scale(1.03)"},
        onMouseLeave:x=>{x.currentTarget.style.borderColor="#ddd";x.currentTarget.style.color="#666";x.currentTarget.style.transform="scale(1)"}},"À propos")
    )
  );

  const aboutOverlay=()=>about?e("div",{style:{position:"absolute",inset:0,background:"#fff",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",padding:"40px 32px",animation:"scaleIn .5s cubic-bezier(.4,0,.2,1)"}},
    e("div",{style:{fontFamily:F,fontSize:28,fontWeight:600,color:"#0a0a0a",letterSpacing:"0.03em",lineHeight:1.15,animation:"slideUp .6s ease .1s both"}},"La vérité",e("br"),"sur vos prix."),
    e("div",{style:{width:0,height:2,background:"#1b6b42",margin:"24px 0",animation:"lineGrow .8s ease .4s forwards"}}),
    ...["Chaque facture scannée est comparée aux données agrégées de milliers d'artisans de votre région.","Décomposition STL · Prophet (saisonnalité française) · Isolation Forest · Benchmarks par percentiles — ajustés par les indices INSEE.","Le modèle Coupa — $8T de données, Fortune 500 — réinventé pour les 4.4M de TPE et artisans français."].map((t,i)=>e("div",{key:i,style:{fontFamily:F,fontSize:14,fontWeight:400,color:"#555",lineHeight:1.9,marginTop:i?14:0,animation:`slideUp .6s ease ${.3+i*.12}s both`}},t)),
    e("div",{style:{fontFamily:F,fontSize:10,color:"#888",letterSpacing:"0.12em",textTransform:"uppercase",marginTop:28,animation:"fadeIn 1s ease 1s both"}},"Démo technique · Données simulées · Sam Samson"),
    e("button",{onClick:()=>setAbout(false),style:{marginTop:32,fontFamily:F,fontSize:12,fontWeight:600,color:"#fff",background:"#0a0a0a",border:"none",padding:"16px 0",cursor:"pointer",letterSpacing:"0.18em",textTransform:"uppercase",transition:"all .3s",animation:"slideUp .5s ease .5s both"},
      onMouseEnter:x=>x.currentTarget.style.background="#1b6b42",onMouseLeave:x=>x.currentTarget.style.background="#0a0a0a"},"Fermer")
  ):null;

  const scannerList=()=>e("div",{style:{padding:"28px 28px 24px"}},
    e("div",{style:{fontFamily:F,fontSize:22,fontWeight:600,color:"#0a0a0a",animation:"slideUp .5s ease"}},"Analyser"),
    e("div",{style:{fontFamily:F,fontSize:13,fontWeight:400,color:"#666",marginTop:6,animation:"slideUp .5s ease .1s both"}},"Sélectionnez une facture pour l'analyse"),
    e("div",{style:{marginTop:28}},
      ...INVOICES.map((iv,i)=>e("button",{key:iv.id,onClick:()=>scan(iv),onMouseEnter:()=>setHov(iv.id),onMouseLeave:()=>setHov(null),
        style:{display:"block",width:"100%",background:hov===iv.id?"#fafafa":"none",border:"none",borderBottom:"1px solid #eee",padding:"22px 0",cursor:"pointer",textAlign:"left",transition:"all .4s cubic-bezier(.4,0,.2,1)",transform:hov===iv.id?"translateX(6px)":"translateX(0)",animation:`slideLeft .5s ease ${i*.1}s both`,fontFamily:F}},
        e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"}},
          e("div",{style:{fontSize:16,fontWeight:600,color:"#0a0a0a"}},iv.supplier),
          e("div",{style:{fontSize:18,fontWeight:600,color:"#0a0a0a"}},iv.total_ht.toFixed(0)+"€ ",e("span",{style:{fontSize:12,fontWeight:400,color:"#888"}},"HT"))
        ),
        e("div",{style:{display:"flex",justifyContent:"space-between",marginTop:8}},
          e("div",{style:{fontSize:11,fontWeight:400,color:"#666",letterSpacing:"0.08em"}},iv.items[0].category.toUpperCase()+" · "+iv.items.length+" ARTICLES"),
          e("div",{style:{fontSize:11,fontWeight:400,color:"#777"}},iv.date)
        ),
        e("div",{style:{height:2,background:"#1b6b42",marginTop:12,borderRadius:1,width:hov===iv.id?"100%":"0%",transition:"width .5s cubic-bezier(.4,0,.2,1)"}})
      ))
    ),
    e("div",{style:{marginTop:40,padding:"32px 0",borderTop:"1px solid #eee",animation:"fadeIn 1s ease .5s both"}},
      e("div",{style:{fontFamily:F,fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.25em",textTransform:"uppercase",textAlign:"center",marginBottom:24}},"Réseau Bill Up"),
      e("div",{style:{display:"flex",justifyContent:"space-around"}},
        ...[["12847","Factures"],["34","Catégories"],["8","Régions"]].map(([n,l],i)=>e("div",{key:l,style:{textAlign:"center",animation:`countUp .6s ease ${.6+i*.15}s both`}},
          e("div",{style:{fontFamily:F,fontSize:24,fontWeight:600,color:"#0a0a0a"}},e(Counter,{value:n})),
          e("div",{style:{fontFamily:F,fontSize:10,fontWeight:400,color:"#777",letterSpacing:"0.14em",textTransform:"uppercase",marginTop:6}},l)
        ))
      )
    ),
    e("div",{style:{padding:"24px 0",textAlign:"center",animation:"fadeIn 1.2s ease .8s both"}},
      e("div",{style:{fontFamily:F,fontSize:14,fontWeight:400,color:"#777",fontStyle:"italic",lineHeight:1.7}},"« Chaque facture enrichit l'intelligence",e("br"),"collective du réseau. »")
    )
  );

  const scanning=()=>e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:440,padding:40,animation:"fadeIn .4s"}},
    e("div",{style:{position:"relative",width:90,height:114,border:"1.5px solid #ddd",background:"#fafafa",animation:"breathe 2.5s ease-in-out infinite"}},
      e("div",{style:{position:"absolute",left:4,right:4,height:2,background:"linear-gradient(90deg,transparent 0%,#1b6b42 30%,#1b6b42 70%,transparent 100%)",boxShadow:"0 0 12px rgba(27,107,66,.3)",animation:"scanMove 1.5s ease-in-out infinite"}}),
      ...[...Array(7)].map((_,i)=>e("div",{key:i,style:{position:"absolute",top:16+i*13,left:12,height:2,borderRadius:1,right:i%3===0?24:i%2===0?16:20,background:"#e8e8e8",animation:`reveal .6s ease ${.2+i*.08}s both`}}))
    ),
    e("div",{style:{fontFamily:F,fontSize:20,fontWeight:500,color:"#0a0a0a",marginTop:32,letterSpacing:"0.05em",animation:"fadeIn .6s ease .3s both"}},"Lecture en cours"),
    e("div",{style:{fontFamily:F,fontSize:12,fontWeight:400,color:"#666",marginTop:8,animation:"fadeIn .6s ease .5s both"}},inv?.supplier),
    e("div",{style:{display:"flex",gap:4,marginTop:20}},...[0,1,2,3,4].map(i=>e("div",{key:i,style:{width:5,height:5,borderRadius:"50%",background:"#1b6b42",animation:`dotBounce 1.4s ease-in-out ${i*.16}s infinite`}})))
  );

  const analyzing=()=>e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:440,padding:40,animation:"fadeIn .3s"}},
    e("div",{style:{position:"relative",width:100,height:100,marginBottom:28}},
      e("svg",{width:"100",height:"100",style:{transform:"rotate(-90deg)"}},
        e("circle",{cx:"50",cy:"50",r:"42",fill:"none",stroke:"#f0f0f0",strokeWidth:"1.5"}),
        e("circle",{cx:"50",cy:"50",r:"42",fill:"none",stroke:"#1b6b42",strokeWidth:"2",strokeDasharray:264,strokeDashoffset:264-(264*prog/100),strokeLinecap:"round",style:{transition:"stroke-dashoffset .3s ease"}})
      ),
      e("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:F,fontSize:22,fontWeight:500,color:"#0a0a0a"}},Math.round(prog))
    ),
    e("div",{style:{fontFamily:F,fontSize:20,fontWeight:500,color:"#0a0a0a",letterSpacing:"0.05em",marginBottom:12}},"Analyse des prix"),
    e("div",{style:{width:220}},
      ...[{label:"Extraction OCR",thresh:0},{label:"Comparaison · 12 847 factures",thresh:28},{label:"Ajustement saisonnier INSEE",thresh:55},{label:"Calcul du score",thresh:78}].map((step,i)=>{
        const active=prog>=step.thresh,done=i<3&&prog>=[28,55,78,100][i];
        return e("div",{key:i,style:{display:"flex",alignItems:"center",gap:10,padding:"6px 0",opacity:active?1:0.25,transition:"opacity .5s ease"}},
          e("div",{style:{width:8,height:8,borderRadius:"50%",flexShrink:0,background:done?"#1b6b42":active?"transparent":"#ddd",border:active&&!done?"2px solid #1b6b42":"none",transition:"all .4s"}},
            active&&!done?e("div",{style:{width:"100%",height:"100%",borderRadius:"50%",animation:"pulseRing 1.5s ease-out infinite",border:"1px solid #1b6b42"}}):null
          ),
          e("span",{style:{fontFamily:F,fontSize:12,fontWeight:active?500:400,color:active?"#333":"#aaa",transition:"all .4s"}},step.label),
          done?e("span",{style:{fontFamily:F,fontSize:11,color:"#1b6b42",marginLeft:"auto"}},"✓"):null
        )
      })
    )
  );

  const results=()=>e("div",{style:{padding:"0 28px 28px"}},
    e("div",{style:{padding:"32px 0 28px",textAlign:"center",borderBottom:"1px solid #eee",animation:"scaleIn .6s cubic-bezier(.4,0,.2,1)"}},
      e("div",{style:{fontFamily:F,fontSize:11,fontWeight:400,color:"#666",letterSpacing:"0.2em",textTransform:"uppercase"}},inv.supplier),
      e("div",{style:{fontFamily:F,fontSize:32,fontWeight:600,color:SEV[worst].color,letterSpacing:"0.06em",marginTop:12,lineHeight:1,animation:"slideUp .7s ease .2s both"}},SEV[worst].label),
      overp>5?e("div",{style:{marginTop:16,animation:"slideUp .6s ease .4s both"}},e("span",{style:{fontFamily:F,fontSize:24,fontWeight:600,color:"#0a0a0a"}},"+",e(Counter,{value:overp.toFixed(0)}),"€"),e("span",{style:{fontFamily:F,fontSize:13,fontWeight:400,color:"#666",marginLeft:8}},"surcoût estimé")):null,
      e("div",{style:{width:0,height:2,background:worst==="good"?"#1b6b42":"#0a0a0a",margin:"20px auto 0",animation:"lineGrow .8s ease .5s forwards"}})
    ),
    e("div",{style:{marginTop:8}},
      ...items.map((item,idx)=>{
        const sev=SEV[item.severity],isOpen=exp===idx;
        return e("div",{key:idx,style:{borderBottom:"1px solid #eee",animation:`slideUp .5s ease ${.3+idx*.12}s both`}},
          e("button",{onClick:()=>setExp(isOpen?null:idx),style:{display:"flex",width:"100%",padding:"20px 0",cursor:"pointer",alignItems:"center",gap:14,background:"none",border:"none",textAlign:"left",transition:"all .3s",fontFamily:F},
            onMouseEnter:x=>x.currentTarget.style.paddingLeft="4px",onMouseLeave:x=>x.currentTarget.style.paddingLeft="0"},
            e("div",{style:{position:"relative",width:12,height:12,flexShrink:0}},
              e("div",{style:{width:12,height:12,borderRadius:"50%",background:sev.color,transition:"transform .4s",transform:isOpen?"scale(1.2)":"scale(1)"}}),
              (item.severity==="danger"||item.severity==="warn")?e("div",{style:{position:"absolute",inset:-2,borderRadius:"50%",border:`1px solid ${sev.color}`,animation:"pulseRing 2s ease-out infinite"}}):null
            ),
            e("div",{style:{flex:1,minWidth:0}},
              e("div",{style:{fontSize:15,fontWeight:600,color:"#0a0a0a"}},item.name),
              e("div",{style:{fontSize:12,fontWeight:400,color:"#666",marginTop:4}},item.price.toFixed(2)+"€ — médiane "+item.median.toFixed(2)+"€")
            ),
            e("div",{style:{textAlign:"right",flexShrink:0}},
              e("div",{style:{fontSize:20,fontWeight:600,color:sev.color}},item.pctAbove>0?"+"+item.pctAbove+"%":"—"),
              e("div",{style:{fontSize:9,color:"#999",marginTop:2,transform:isOpen?"rotate(180deg)":"rotate(0deg)",transition:"transform .4s cubic-bezier(.4,0,.2,1)",display:"inline-block"}},"▼")
            )
          ),
          isOpen?e("div",{style:{paddingBottom:24,overflow:"hidden",animation:"expandH .5s ease"}},
            e("div",{style:{animation:"fadeIn .5s ease .1s both"}},
              e("div",{style:{fontFamily:F,fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.18em",textTransform:"uppercase",marginBottom:4}},"Fourchette de prix · Île-de-France"),
              e(RangeBar,{p10:item.p10,median:item.median,p90:item.p90,current:item.price}),
              e("div",{style:{fontFamily:F,fontSize:11,fontWeight:400,color:item.n>100?"#1b6b42":"#777",marginTop:4}},(item.n>100?"● Haute":item.n>30?"● Moyenne":"● Faible")+" confiance — "+item.n.toLocaleString("fr-FR")+" factures · "+item.nSuppliers+" fournisseurs")
            ),
            e("div",{style:{marginTop:22,animation:"fadeIn .6s ease .2s both"}},
              e("div",{style:{fontFamily:F,fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.18em",textTransform:"uppercase",marginBottom:8}},"Évolution sur 12 mois"),
              e("div",{style:{background:"#fafafa",padding:"10px 4px",borderRadius:4,border:"1px solid #f0f0f0"}},e(Sparkline,{data:item.trend,currentPrice:item.price,median:item.median,p10:item.p10,p90:item.p90}))
            ),
            (item.seasonMsg||item.inseeRef)?e("div",{style:{marginTop:18,paddingLeft:14,borderLeft:"3px solid #1b6b42",animation:"slideLeft .5s ease .3s both"}},
              item.seasonMsg?e("div",{style:{fontFamily:F,fontSize:13,fontWeight:400,color:"#555",lineHeight:1.6}},item.seasonMsg):null,
              item.inseeRef?e("div",{style:{fontFamily:F,fontSize:12,fontWeight:400,color:"#666",marginTop:item.seasonMsg?6:0}},item.inseeRef):null
            ):null,
            item.alternatives.length>0?e("div",{style:{marginTop:22,animation:"fadeIn .6s ease .35s both"}},
              e("div",{style:{fontFamily:F,fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.18em",textTransform:"uppercase",marginBottom:10}},"Fournisseurs alternatifs"),
              ...item.alternatives.map((alt,ai)=>e("div",{key:ai,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0",borderBottom:ai<item.alternatives.length-1?"1px solid #f5f5f5":"none",animation:`slideLeft .4s ease ${.4+ai*.08}s both`,cursor:"pointer",transition:"background .3s",fontFamily:F},
                onMouseEnter:x=>x.currentTarget.style.background="#fafafa",onMouseLeave:x=>x.currentTarget.style.background="transparent"},
                e("span",{style:{fontSize:14,fontWeight:400,color:"#333"}},alt.name),
                e("div",{style:{display:"flex",alignItems:"center",gap:10}},
                  e("span",{style:{fontSize:15,fontWeight:600,color:"#1b6b42"}},alt.price.toFixed(1)+"€"),
                  e("span",{style:{fontSize:10,fontWeight:600,color:"#fff",background:"#1b6b42",padding:"3px 8px",borderRadius:2}},"−"+Math.round(((item.price-alt.price)/item.price)*100)+"%")
                )
              ))
            ):null
          ):null
        )
      })
    ),
    e("div",{style:{display:"flex",gap:12,marginTop:28,animation:"slideUp .5s ease .6s both"}},
      e("button",{onClick:reset,style:{flex:1,padding:"16px 0",background:"none",border:"1.5px solid #ddd",fontFamily:F,fontSize:11,fontWeight:500,color:"#666",cursor:"pointer",letterSpacing:"0.14em",textTransform:"uppercase",transition:"all .4s"},
        onMouseEnter:x=>{x.currentTarget.style.borderColor="#0a0a0a";x.currentTarget.style.color="#0a0a0a"},onMouseLeave:x=>{x.currentTarget.style.borderColor="#ddd";x.currentTarget.style.color="#666"}},"Retour"),
      e("button",{style:{flex:2,padding:"16px 0",background:"#0a0a0a",border:"none",fontFamily:F,fontSize:11,fontWeight:600,color:"#fff",cursor:"pointer",letterSpacing:"0.14em",textTransform:"uppercase",transition:"all .4s"},
        onMouseEnter:x=>x.currentTarget.style.background="#1b6b42",onMouseLeave:x=>x.currentTarget.style.background="#0a0a0a"},"Négocier")
    )
  );

  const dashboard=()=>e("div",{style:{padding:28,animation:"fadeIn .4s",fontFamily:F}},
    e("div",{style:{fontSize:22,fontWeight:600,color:"#0a0a0a",animation:"slideUp .5s ease"}},"Synthèse"),
    e("div",{style:{fontSize:13,fontWeight:400,color:"#666",marginTop:6,animation:"slideUp .5s ease .1s both"}},"Vue d'ensemble mensuelle"),
    e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,marginTop:28,background:"#eee"}},
      ...[["12450","Dépenses du mois","€",""],["680","Surcoût détecté","€","+"  ],["23","Factures analysées","",""],["4","Alertes actives","",""]].map(([v,l,suf,pre],i)=>
        e("div",{key:l,style:{background:"#fff",padding:"24px 18px",textAlign:"center",animation:`scaleIn .5s ease ${.2+i*.1}s both`}},
          e("div",{style:{fontSize:24,fontWeight:600,color:"#0a0a0a"}},e(Counter,{value:v,suffix:suf,prefix:pre})),
          e("div",{style:{fontSize:10,fontWeight:400,color:"#777",letterSpacing:"0.12em",textTransform:"uppercase",marginTop:8}},l)
        )
      )
    ),
    e("div",{style:{marginTop:36}},
      e("div",{style:{fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.22em",textTransform:"uppercase",marginBottom:18,animation:"fadeIn .6s ease .4s both"}},"Catégories à surveiller"),
      ...[{cat:"Plomberie — Cuivre",pct:23,sev:"danger",amt:"312€"},{cat:"Bois — Panneaux OSB",pct:21,sev:"danger",amt:"228€"},{cat:"Électricité — Câbles",pct:16,sev:"warn",amt:"140€"},{cat:"Quincaillerie",pct:3,sev:"good",amt:"—"}].map((r,i)=>
        e("div",{key:r.cat,style:{display:"flex",alignItems:"center",padding:"14px 0",borderBottom:"1px solid #f3f3f3",gap:12,animation:`slideLeft .5s ease ${.5+i*.08}s both`,cursor:"pointer",transition:"all .3s"},
          onMouseEnter:x=>x.currentTarget.style.paddingLeft="6px",onMouseLeave:x=>x.currentTarget.style.paddingLeft="0"},
          e("div",{style:{width:8,height:8,borderRadius:"50%",background:SEV[r.sev].color,flexShrink:0}}),
          e("div",{style:{flex:1,fontSize:14,fontWeight:400,color:"#333"}},r.cat),
          e("div",{style:{width:50,height:4,background:"#f0f0f0",borderRadius:2,overflow:"hidden",flexShrink:0}},e("div",{style:{height:"100%",background:SEV[r.sev].color,width:`${Math.min(r.pct*4,100)}%`,borderRadius:2,transition:"width 1s ease"}})),
          e("div",{style:{fontSize:15,fontWeight:700,color:SEV[r.sev].color,minWidth:42,textAlign:"right"}},"+"+r.pct+"%"),
          e("div",{style:{fontSize:12,fontWeight:400,color:"#888",minWidth:38,textAlign:"right"}},r.amt)
        )
      )
    ),
    e("div",{style:{marginTop:36}},
      e("div",{style:{fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.22em",textTransform:"uppercase",marginBottom:18,animation:"fadeIn .6s ease .6s both"}},"Classement fournisseurs"),
      ...[{name:"Brossette Paris",score:92},{name:"Rexel Île-de-France",score:87},{name:"Cedeo Créteil",score:78},{name:"Martin Fournitures",score:41}].map((s,i)=>
        e("div",{key:s.name,style:{display:"flex",alignItems:"center",padding:"12px 0",borderBottom:"1px solid #f3f3f3",gap:14,animation:`slideLeft .5s ease ${.7+i*.08}s both`}},
          e("div",{style:{fontSize:16,fontWeight:400,color:"#999",width:24,textAlign:"center"}},i+1),
          e("div",{style:{flex:1,fontSize:14,fontWeight:400,color:"#333"}},s.name),
          e("div",{style:{width:70,height:3,background:"#f0f0f0",borderRadius:2,overflow:"hidden",position:"relative"}},e("div",{style:{position:"absolute",left:0,top:0,height:"100%",borderRadius:2,background:s.score>80?"#1b6b42":s.score>60?"#888":"#1a1a1a",width:`${s.score}%`,transition:"width 1.2s cubic-bezier(.4,0,.2,1)"}})),
          e("div",{style:{fontSize:15,fontWeight:600,color:s.score>80?"#1b6b42":s.score>60?"#888":"#1a1a1a",minWidth:28,textAlign:"right"}},s.score)
        )
      )
    )
  );

  const insights=()=>e("div",{style:{padding:28,animation:"fadeIn .4s",fontFamily:F}},
    e("div",{style:{fontSize:22,fontWeight:600,color:"#0a0a0a",animation:"slideUp .5s ease"}},"Marché"),
    e("div",{style:{fontSize:13,fontWeight:400,color:"#666",marginTop:6,animation:"slideUp .5s ease .1s both"}},"Indices INSEE & tendances BTP"),
    e("div",{style:{marginTop:28,padding:"36px 0",borderTop:"1px solid #eee",borderBottom:"1px solid #eee",textAlign:"center",animation:"scaleIn .6s ease .2s both"}},
      e("div",{style:{fontSize:10,fontWeight:500,color:"#777",letterSpacing:"0.25em",textTransform:"uppercase"}},"Indice BT01 — Février 2026"),
      e("div",{style:{fontSize:44,fontWeight:500,color:"#0a0a0a",marginTop:12,lineHeight:1}},e(Counter,{value:"132",duration:1500}),e("span",{style:{fontSize:34}},".4")),
      e("div",{style:{fontSize:13,fontWeight:500,color:"#1b6b42",marginTop:12,letterSpacing:"0.06em",animation:"fadeIn .8s ease .6s both"}},"↑ +1.8% sur 12 mois"),
      e("div",{style:{fontSize:10,fontWeight:400,color:"#888",marginTop:10}},"Source : INSEE, série 001710986 · Base 2010")
    ),
    e("div",{style:{marginTop:28}},
      ...[{title:"Cuivre en hausse",body:"Le cours du cuivre a augmenté de 12% depuis septembre. Impact direct sur la plomberie. Vos prix devraient refléter +2.1% max (indice BT40).",tag:"ALERTE",tagBg:"#0a0a0a",tagC:"#fff"},{title:"Panneaux bois : baisse attendue",body:"L'IPP panneaux bois recule de −1.2% sur 12 mois. Si votre fournisseur augmente, c'est un signal d'alerte.",tag:"OPPORTUNITÉ",tagBg:"#1b6b42",tagC:"#fff"},{title:"Câbles R2V : stabilisation",body:"Après la flambée 2024, les prix se sont stabilisés au S2 2025. Médiane nationale : 162.50€/100m.",tag:"STABLE",tagBg:"#f0f0f0",tagC:"#444"}].map((ins,i)=>
        e("div",{key:i,style:{padding:"22px 0",borderBottom:"1px solid #eee",animation:`slideUp .5s ease ${.3+i*.1}s both`,cursor:"pointer",transition:"all .3s"},
          onMouseEnter:x=>x.currentTarget.style.paddingLeft="8px",onMouseLeave:x=>x.currentTarget.style.paddingLeft="0"},
          e("span",{style:{fontSize:9,fontWeight:600,color:ins.tagC,background:ins.tagBg,padding:"4px 10px",letterSpacing:"0.14em",display:"inline-block",marginBottom:10}},ins.tag),
          e("div",{style:{fontSize:17,fontWeight:600,color:"#0a0a0a",marginBottom:8,lineHeight:1.3}},ins.title),
          e("div",{style:{fontSize:13,fontWeight:400,color:"#555",lineHeight:1.8}},ins.body)
        )
      )
    ),
    e("div",{style:{marginTop:32,padding:"32px 24px",background:"#0a0a0a",textAlign:"center",animation:"slideUp .6s ease .6s both",position:"relative",overflow:"hidden"}},
      e("div",{style:{position:"absolute",inset:0,background:"radial-gradient(circle at 30% 50%,rgba(27,107,66,.15) 0%,transparent 60%)"}}),
      e("div",{style:{position:"relative"}},
        e("div",{style:{fontSize:10,fontWeight:500,color:"#bbb",letterSpacing:"0.22em",textTransform:"uppercase"}},"Économie potentielle"),
        e("div",{style:{fontSize:36,fontWeight:600,color:"#fff",marginTop:10}},e(Counter,{value:"2340",duration:1800}),"€"),
        e("div",{style:{fontSize:12,fontWeight:400,color:"#aaa",marginTop:8}},"sur les 12 derniers mois"),
        e("div",{style:{width:0,height:1,background:"#1b6b42",margin:"16px auto 0",animation:"lineGrow .8s ease 1s forwards"}})
      )
    )
  );

  const nav=()=>e("div",{style:{display:"flex",borderTop:"1px solid #eee",background:"#fff",flexShrink:0,paddingBottom:"env(safe-area-inset-bottom,0px)"}},
    ...[{id:"scanner",label:"ANALYSER"},{id:"dashboard",label:"SYNTHÈSE"},{id:"insights",label:"MARCHÉ"}].map(t=>
      e("button",{key:t.id,onClick:()=>{setTab(t.id);if(t.id!=="scanner")reset()},
        style:{flex:1,padding:"16px 0 14px",background:"none",border:"none",cursor:"pointer",fontFamily:F,fontSize:10,fontWeight:tab===t.id?600:400,letterSpacing:"0.18em",color:tab===t.id?"#0a0a0a":"#999",transition:"all .4s cubic-bezier(.4,0,.2,1)",borderTop:tab===t.id?"2.5px solid #0a0a0a":"2.5px solid transparent"},
        onMouseEnter:x=>{if(tab!==t.id)x.currentTarget.style.color="#666"},onMouseLeave:x=>{if(tab!==t.id)x.currentTarget.style.color="#999"}},t.label)
    )
  );

  const content=()=>{
    if(tab==="scanner"&&!phase)return scannerList();
    if(phase==="scan")return scanning();
    if(phase==="analyze")return analyzing();
    if(phase==="result"&&inv)return results();
    if(tab==="dashboard")return dashboard();
    if(tab==="insights")return insights();
    return null;
  };

  return e("div",{style:{width:400,maxWidth:"100vw",height:"100dvh",maxHeight:isD?860:"none",background:"#fff",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",borderRadius:isD?24:0,boxShadow:isD?"0 50px 150px rgba(0,0,0,.6)":"none",border:isD?"1px solid #1a1a1a":"none",margin:"0 auto"}},
    hdr(),
    aboutOverlay(),
    e("div",{style:{flex:1,overflow:"auto",WebkitOverflowScrolling:"touch"}},content()),
    nav()
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
